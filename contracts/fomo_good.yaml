name: rover_diff_drive
version: 1

robot_type: rover
rate_hz: 10
max_duration_s: 120.0

metadata:
  task:
    type: constant
    value: rover_diff_drive

observations:

  # --- CÃ¡mara RGB principal ---
  - key: observation.image.main
    topic: /camera/color/image_raw
    type: sensor_msgs/msg/Image
    image: 
      resize: [512,512]
    align: {resample_policy: hold, stamp: header, tol_ms: 1500}
    qos: {reliability: best_effort, history: keep_last, depth: 10}

  # --- IMU principal ---
  - key: observation.state.imu
    topic: /camera/imu
    type: sensor_msgs/msg/Imu
    selector:
      names: [
        orientation.x, orientation.y, orientation.z, orientation.w,
        angular_velocity.x, angular_velocity.y, angular_velocity.z,
        linear_acceleration.x, linear_acceleration.y, linear_acceleration.z
      ]
    align: {resample_policy: hold, stamp: header, tol_ms: 100}
    qos: {reliability: best_effort, history: keep_last, depth: 50}

  # --- Odometry local ---
  - key: observation.state.odometry_local
    topic: /odometry/local
    type: nav_msgs/msg/Odometry
    selector:
      names: [
        pose.pose.position.x, pose.pose.position.y, pose.pose.position.z,
        twist.twist.linear.x, twist.twist.angular.z
      ]
    align: {resample_policy: hold, stamp: header, tol_ms: 150}

  # --- Odometry global ---
  - key: observation.state.odometry_global
    topic: /odometry/global
    type: nav_msgs/msg/Odometry
    selector:
      names: [
        pose.pose.position.x, pose.pose.position.y, pose.pose.position.z,
        twist.twist.linear.x, twist.twist.angular.z
      ]
    align: {resample_policy: hold, stamp: header, tol_ms: 150}

actions:
  - key: action
    publish:
      topic: /motion_control/speed_controller/output_cmd
      type: geometry_msgs/msg/Twist
      layout: flat
      qos: {reliability: best_effort, history: keep_last, depth: 10}
      strategy:
        mode: nearest
        tolerance_ms: 500
    selector:
      names: [linear.x, linear.y, linear.z]  # velocidades lineales
    from_tensor:
      clamp: [-2.0, 2.0]
    safety_behavior: zeros

recording:
  storage: mcap